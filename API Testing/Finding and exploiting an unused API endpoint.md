# Finding and exploiting an unused API endpoint

**Scenario:** 
To solve the lab, exploit a hidden API endpoint to buy a Lightweight l33t Leather Jacket. You can log in to your own account using the following credentials: wiener:peter.

Our first step here will be to login to our account using the username: wiener and the password: peter. Once logged in we'll want to select the **Lightweight l33t Leather Jacket**, capture the GET request, and forward it to Repeater.

<img width="3366" height="1808" alt="image" src="https://github.com/user-attachments/assets/a9bb8894-fb78-4ddb-9991-60f027e231a5" />

We can now change the the API method in the request to be something that we know will return us an error but will likely tell us which methods are allowed. As you can see below, the allowed methods are GET and PATCH. Since we tried GET already, we can test with PATCH.

<img width="3366" height="1808" alt="image" src="https://github.com/user-attachments/assets/5d6fb246-3134-43b5-bf0f-89a7824800d3" />

After testing with the PATCH method, we get an error message stating that the **Content-Type** that's supported is **application/json**. 

<img width="3366" height="1808" alt="image" src="https://github.com/user-attachments/assets/7295c197-ad26-4c09-8fd4-72be5bcefcf1" />

Easy enough, we can add **Content-Type: application/json** anywhere in the header. Make sure to include the JSON body **{  }** as well or we'll receive an internal system error. 

<img width="3378" height="1808" alt="image" src="https://github.com/user-attachments/assets/28d90a58-35ca-48c3-8fb8-ddb40d24c21d" />

We can see now the JSON body is expecting a **price**. Because we are trying to buy the jacket for $0, we can simply add **"price":0** to the JSON body in which we'll receive a 200 and the price of the jacket has been updated to $0 on the website.

<img width="3378" height="1808" alt="image" src="https://github.com/user-attachments/assets/464240fc-86a0-484e-a721-f65f4da99eee" />

<img width="3378" height="1550" alt="image" src="https://github.com/user-attachments/assets/4e449893-2cec-4267-b8e3-895032d70e4d" />

**Takeaway:**
I essentially acted as a digital detective to find a "secret door." First, I had to figure out what methods the hidden endpoint allowed as I tried different requests until I discovered that the PATCH method was enabled. Next, the server told me that it only accepted JSON data. Once I had those pieces, the final, biggest flaw was a Broken Access Control vulnerability: the server never checked if I, a regular user, was allowed to change the item's price. By sending a simple piece of data such as "price":0 in the JSON request body, I instantly changed the jacket's cost to zero. This emphasizes the need to enforce server-side authorization checks on every single piece of data a user tries to modify, even on hidden functions.
